<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cancer Data Dashboard</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        .chart-container {
            width: 90%;
            margin: auto;
            padding: 20px;
        }
        #map-container {
            width: 90%;
            height: 600px;
            margin: auto;
        }
        .progress-bar {
            width: 90%;
            height: 10px;
            background-color: #ddd;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px auto;
            position: relative;
        }
        .progress {
            height: 100%;
            width: 0%;
            background-color: #007bff;
            transition: width 0.3s linear;
        }
        .navigation {
            margin-top: 10px;
        }
        .nav-button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
            margin: 5px;
        }
        .nav-button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <h1>Cancer Data Dashboard</h1>

    <!-- Container for the map -->
    <div id="map-container">
        {{ main_map | safe }}
    </div>

    <!-- Progress Bar -->
    <div class="progress-bar">
        <div class="progress" id="progress-bar"></div>
    </div>

    <!-- Navigation Buttons -->
    <div class="navigation">
        <button class="nav-button" onclick="prevCancerMap()">&#8592; Previous</button>
        <button class="nav-button" onclick="nextCancerMap()">Next &#8594;</button>
    </div>

    <script>
        let cancerTypes = [
            "lung", "thyroid", "prevalence", "deaths", "development",
            "radiation_exposure", "smoking", "obesity", "diabetes"
        ];
    
        let index = 0;
        let intervalTime = 30000; // 30 seconds
        let progressBar = document.getElementById("progress-bar");
        let progressInterval;
    
        function loadCancerMap() {
            let cancerType = cancerTypes[index];
            $.getJSON(`/highlight_map/${cancerType}`, function(data) {
                $("#map-container").html(data.map_html);
            });
            resetProgressBar();
        }
    
        function prevCancerMap() {
            index = (index - 1 + cancerTypes.length) % cancerTypes.length;
            loadCancerMap();
        }
    
        function nextCancerMap() {
            index = (index + 1) % cancerTypes.length;
            loadCancerMap();
        }
    
        function resetProgressBar() {
            clearInterval(progressInterval); // Stop any existing animation
            progressBar.style.width = "0%";
            animateProgressBar();
        }
    
        function animateProgressBar() {
            let startTime = performance.now();
            function step(currentTime) {
                let elapsed = currentTime - startTime;
                let progress = Math.min(elapsed / intervalTime, 1);
                progressBar.style.width = (progress * 100) + "%";
                if (progress < 1) {
                    requestAnimationFrame(step);
                }
            }
            requestAnimationFrame(step);
        }
    
        setInterval(() => {
            nextCancerMap();
        }, intervalTime);
    
        loadCancerMap();
    </script>
</body>
</html>